// === BOUTON DISCORD ===
let authWindow = null;

document.getElementById('discord-btn').onclick = () => {
  if (window.electronAPI && window.electronAPI.openDiscordAuth) {
    window.electronAPI.openDiscordAuth();
  }

  const btn = document.getElementById('discord-btn');
  btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i><span>Connexion...</span>';
  btn.disabled = true;
};

// === RÉCEPTION DU SUCCÈS ===
ipcRenderer.on('discord-login-success', (event, user) => {
  connectUser(user.username);
  resetDiscordButton();
});

ipcRenderer.on('discord-login-error', () => {
  alert('Erreur de connexion Discord');
  resetDiscordButton();
});

ipcRenderer.on('discord-auth-closed', () => {
  resetDiscordButton();
});

function resetDiscordButton() {
  const btn = document.getElementById('discord-btn');
  btn.innerHTML = '<i class="fa-brands fa-discord"></i><span>Login with Discord</span>';
  btn.disabled = false;
}

// === CONNEXION ===
function connectUser(name) {
  document.getElementById('username').textContent = name;

  loginPanel.classList.remove('show');
  setTimeout(() => {
    loginPanel.classList.add('hidden');
    homePanel.classList.remove('hidden');
    setTimeout(() => homePanel.classList.add('show'), 100);
  }, 600);
}
